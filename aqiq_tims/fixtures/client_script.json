[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2024-08-14 12:56:54.245845",
  "module": "AQIQ TIMS Integration",
  "name": "Sales Invoice",
  "script": "var sendKraAPI = function(frm) {\r\n    frappe.call({\r\n        method: 'aqiq_tims.services.rest.send_request',\r\n        args: {\"invoice\": frm.doc.name},\r\n        callback: (r) => {\r\n            if (r.message.ResponseCode === '000') {\r\n                frappe.msgprint({\r\n                    title: __('KRA Response Success'),\r\n                    indicator: 'green',\r\n                    message: __('Successfully Submitted to KRA.')\r\n                });\r\n                frm.remove_custom_button(\"Send KRA\");\r\n                frm.set_value('custom_sent_to_kra', 1);\r\n                frm.save_or_update();\r\n            } else {\r\n                frappe.msgprint({\r\n                    title: __('KRA Response Failed'),\r\n                    indicator: 'red',\r\n                    message: __('Invoice Submission to KRA Failed. Please Check KRA Response Generated.')\r\n                });\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\nfrappe.ui.form.on('Sales Invoice', {\r\n    refresh(frm) {\r\n        // Adding the \"Send to KRA\" button if the invoice has not been sent to KRA yet\r\n        if (frm.doc.docstatus == 1 && !frm.doc.custom_sent_to_kra) {\r\n            frm.add_custom_button('Send To KRA', function() {\r\n                sendKraAPI(frm);\r\n            }).addClass(\"btn btn-danger\");\r\n        }\r\n    },\r\n    on_submit(frm) {\r\n        \r\n        if (!frm.doc.sent_to_kra) {\r\n            sendKraAPI(frm);\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 }
]