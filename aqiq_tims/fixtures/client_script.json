[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2024-07-10 13:24:08.812171",
  "module": "AQIQ TIMS Integration",
  "name": "Sales Invoice",
  "script": "// This is for sending Invoices to KRA with button Send KRA \r\n// Put below script in Sales Invoice client script to call kra api on click of button\r\n\r\nvar sendKraAPI = function(frm){\r\n    if(frm.doc.docstatus===1){\r\n        var sendKraBtn = frm.add_custom_button('Send To KRA', function(){\r\n            frappe.call({\r\n                method: 'aqiq_tims.services.rest.send_request',\r\n                args: {\"invoice\": frm.doc.name},\r\n                callback: (r) => {\r\n                    if (r.message.ResponseCode==='000'){\r\n                        frappe.msgprint({\r\n                            title: __('KRA Response Success'),\r\n                            indicator: 'green',\r\n                            message: __('Successfully Submitted to KRA.')\r\n                            });\r\n                        frm.remove_custom_button(\"Send KRA\");\r\n                    } else{\r\n                        frappe.msgprint({\r\n                            title: __('KRA Response Failed.'),\r\n                            indicator: 'red',\r\n                            message: __('Invoice Submission to KRA Failed. Please Check KRA Response Generated.')\r\n                            });\r\n                    }\r\n                }\r\n            })\r\n        });\r\n        sendKraBtn.addClass(\"btn btn-danger\");\r\n    }\r\n}\r\n\r\nfrappe.ui.form.on('Sales Invoice', {\r\n\trefresh(frm){\r\n\t    if(frm.doc.docstatus == 1 && (frm.doc.cuin == null||'undefined'||'') && (frm.doc.kra_qr_code == null||'undefined'||'') && !frm.doc.sent_to_kra){\r\n\t        sendKraAPI(frm);\r\n\t    }\r\n\t}\r\n});\r\n",
  "view": "Form"
 }
]